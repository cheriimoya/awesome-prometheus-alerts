groups:

- name: StrechSidekiqExporter

  rules:

    - alert: SidekiqQueueSize
      expr: 'sidekiq_queue_size > 100'
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Sidekiq queue size"
        description: "Sidekiq queue {{ $labels.name }} is growing\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: SidekiqSchedulingLatencyTooHigh
      expr: 'max(sidekiq_queue_latency) > 60'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Sidekiq scheduling latency too high"
        description: "Sidekiq jobs are taking more than 1min to be picked up. Users may be seeing delays in background processing.\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

