groups:

- name: RibbybibbySslExporter

  rules:

    - alert: SslCertificateProbeFailed
      expr: 'ssl_probe_success == 0'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: SSL certificate probe failed"
        description: "Failed to fetch SSL information {{ $labels.instance }}\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: SslCertificateOscpStatusUnknown
      expr: 'ssl_ocsp_response_status == 2'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: SSL certificate OSCP status unknown"
        description: "Failed to get the OSCP status {{ $labels.instance }}\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: SslCertificateRevoked
      expr: 'ssl_ocsp_response_status == 1'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: SSL certificate revoked"
        description: "SSL certificate revoked {{ $labels.instance }}\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: SslCertificateExpiry(<7Days)
      expr: 'ssl_verified_cert_not_after{chain_no="0"} - time() < 86400 * 7'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: SSL certificate expiry (< 7 days)"
        description: "{{ $labels.instance }} Certificate is expiring in 7 days\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

