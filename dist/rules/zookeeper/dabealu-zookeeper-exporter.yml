groups:

- name: DabealuZookeeperExporter

  rules:

    - alert: ZookeeperDown
      expr: 'zk_up == 0'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Zookeeper Down"
        description: "Zookeeper down on instance {{ $labels.instance }}\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ZookeeperMissingLeader
      expr: 'sum(zk_server_leader) == 0'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Zookeeper missing leader"
        description: "Zookeeper cluster has no node marked as leader\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ZookeeperTooManyLeaders
      expr: 'sum(zk_server_leader) > 1'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Zookeeper Too Many Leaders"
        description: "Zookeeper cluster has too many nodes marked as leader\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ZookeeperNotOk
      expr: 'zk_ruok == 0'
      for: 3m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Zookeeper Not Ok"
        description: "Zookeeper instance is not ok\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

