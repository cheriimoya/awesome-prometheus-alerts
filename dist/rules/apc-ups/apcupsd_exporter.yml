groups:

- name: Apcupsd_exporter

  rules:

    - alert: ApcUpsBatteryNearlyEmpty
      expr: 'apcupsd_battery_charge_percent < 10'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: APC UPS Battery nearly empty"
        description: "Battery is almost empty (< 10% left)\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ApcUpsLessThan15MinutesOfBatteryTimeRemaining
      expr: 'apcupsd_battery_time_left_seconds < 900'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: APC UPS Less than 15 Minutes of battery time remaining"
        description: "Battery is almost empty (< 15 Minutes remaining)\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ApcUpsAcInputOutage
      expr: 'apcupsd_battery_time_on_seconds > 0'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: APC UPS AC input outage"
        description: "UPS now running on battery (since {{$value | humanizeDuration}})\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ApcUpsLowBatteryVoltage
      expr: '(apcupsd_battery_volts / apcupsd_battery_nominal_volts) < 0.95'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: APC UPS low battery voltage"
        description: "Battery voltage is lower than nominal (< 95%)\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ApcUpsHighTemperature
      expr: 'apcupsd_internal_temperature_celsius >= 40'
      for: 2m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: APC UPS high temperature"
        description: "Internal temperature is high ({{$value}}Â°C)\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ApcUpsHighLoad
      expr: 'apcupsd_ups_load_percent > 80'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: APC UPS high load"
        description: "UPS load is > 80%\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

