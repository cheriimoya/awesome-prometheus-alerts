groups:

- name: Zfs_exporter

  rules:

    - alert: ZfsPoolOutOfSpace
      expr: 'zfs_pool_free_bytes * 100 / zfs_pool_size_bytes < 10 and ON (instance, device, mountpoint) zfs_pool_readonly == 0'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: ZFS pool out of space"
        description: "Disk is almost full (< 10% left)\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ZfsPoolUnhealthy
      expr: 'zfs_pool_health > 0'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: ZFS pool unhealthy"
        description: "ZFS pool state is {{ $value }}. See comments for more information.\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: ZfsCollectorFailed
      expr: 'zfs_scrape_collector_success != 1'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: ZFS collector failed"
        description: "ZFS collector for {{ $labels.instance }} has failed to collect information\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

