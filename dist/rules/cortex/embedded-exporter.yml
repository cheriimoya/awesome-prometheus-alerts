groups:

- name: EmbeddedExporter

  rules:

    - alert: CortexRulerConfigurationReloadFailure
      expr: 'cortex_ruler_config_last_reload_successful != 1'
      for: 0m
      labels:
        severity: warning
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Cortex ruler configuration reload failure"
        description: "Cortex ruler configuration reload failure\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: CortexNotConnectedToAlertmanager
      expr: 'cortex_prometheus_notifications_alertmanagers_discovered < 1'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Cortex not connected to Alertmanager"
        description: "Cortex not connected to Alertmanager\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: CortexNotificationAreBeingDropped
      expr: 'rate(cortex_prometheus_notifications_dropped_total[5m]) > 0'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Cortex notification are being dropped"
        description: "Cortex notification are being dropped due to errors\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: CortexNotificationError
      expr: 'rate(cortex_prometheus_notifications_errors_total[5m]) > 0'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Cortex notification error"
        description: "Cortex is failing when sending alert notifications\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: CortexIngesterUnhealthy
      expr: 'cortex_ring_members{state="Unhealthy", name="ingester"} > 0'
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Cortex ingester unhealthy"
        description: "Cortex has an unhealthy ingester\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

    - alert: CortexFrontendQueriesStuck
      expr: 'sum by (job) (cortex_query_frontend_queue_length) > 0'
      for: 5m
      labels:
        severity: critical
      annotations:
        summary: "{% if $labels.alias %}{{ $labels.alias }}{% else %}{{ $labels.instance }}: Cortex frontend queries stuck"
        description: "There are queued up queries in query-frontend.\nVALUE = {{ $value }}\n{{ range $k, $v := $labels }}{{ $k }}=\"{{ $v }}\" {{ end }}"

